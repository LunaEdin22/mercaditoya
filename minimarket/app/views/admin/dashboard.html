{% extends "base.html" %}

{% block title %}Dashboard Admin - MercaditoYa{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">
            <i class="fas fa-tachometer-alt me-2"></i>Dashboard de Administración
        </h1>
        <span class="badge bg-success fs-6">Administrador</span>
    </div>

    <!-- Tarjetas de estadísticas -->
    <div class="row g-4 mb-5">
        <div class="col-xl-3 col-md-6">
            <div class="card bg-primary text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="small">Total Productos</div>
                            <div class="h2 fw-bold">{{ total_productos }}</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-box fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" href="{{ url_for('productos.admin_listar_productos') }}">
                        Ver Detalles
                    </a>
                    <div class="small text-white">
                        <i class="fas fa-angle-right"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card bg-warning text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="small">Sin Stock</div>
                            <div class="h2 fw-bold">{{ productos_sin_stock }}</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-exclamation-triangle fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" href="{{ url_for('productos.admin_listar_productos') }}?stock=0">
                        Ver Productos
                    </a>
                    <div class="small text-white">
                        <i class="fas fa-angle-right"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card bg-success text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="small">Categorías</div>
                            <div class="h2 fw-bold">{{ categorias_count }}</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-tags fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" href="{{ url_for('productos.admin_listar_categorias') }}">
                        Ver Categorías
                    </a>
                    <div class="small text-white">
                        <i class="fas fa-angle-right"></i>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card bg-info text-white h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>
                            <div class="small">Pedidos Hoy</div>
                            <div class="h2 fw-bold">{{ pedidos_hoy or 0 }}</div>
                        </div>
                        <div class="align-self-center">
                            <i class="fas fa-shopping-bag fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" href="{{ url_for('pedidos.admin_listar_pedidos') }}">
                        Ver Pedidos
                    </a>
                    <div class="small text-white">
                        <i class="fas fa-angle-right"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Productos recientes -->
        <div class="col-lg-8">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-box me-2"></i>Productos Recientes
                    </h5>
                </div>
                <div class="card-body">
                    {% if productos_recientes %}
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Categoría</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for producto in productos_recientes %}
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if producto.imagen_url %}
                                            <img src="{{ producto.imagen_url }}" class="rounded me-2" 
                                                 style="width: 40px; height: 40px; object-fit: cover;">
                                            {% else %}
                                            <div class="bg-light rounded me-2 d-flex align-items-center justify-content-center" 
                                                 style="width: 40px; height: 40px;">
                                                <i class="fas fa-image text-muted"></i>
                                            </div>
                                            {% endif %}
                                            <div>
                                                <div class="fw-bold">{{ producto.nombre }}</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>{{ producto.categoria.nombre }}</td>
                                    <td>S/. {{ "%.2f"|format(producto.precio) }}</td>
                                    <td>
                                        {% if producto.stock > 0 %}
                                        <span class="badge bg-success">{{ producto.stock }}</span>
                                        {% else %}
                                        <span class="badge bg-danger">Sin stock</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{{ url_for('productos.admin_editar_producto', id=producto.id_producto) }}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <p class="text-muted text-center py-4">No hay productos registrados</p>
                    {% endif %}
                </div>
                <div class="card-footer">
                    <a href="{{ url_for('productos.admin_listar_productos') }}" class="btn btn-primary">
                        Ver Todos los Productos
                    </a>
                </div>
            </div>
        </div>

        <!-- Acciones rápidas -->
        <div class="col-lg-4">
            <div class="card h-100">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-plus me-2"></i>Acciones Rápidas
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('productos.admin_nuevo_producto') }}" class="btn btn-primary">
                            <i class="fas fa-plus me-2"></i>Nuevo Producto
                        </a>
                        <a href="{{ url_for('productos.admin_nueva_categoria') }}" class="btn btn-success">
                            <i class="fas fa-tag me-2"></i>Nueva Categoría
                        </a>
                        <a href="{{ url_for('pedidos.admin_listar_pedidos') }}" class="btn btn-info">
                            <i class="fas fa-list me-2"></i>Ver Pedidos
                        </a>
                        <a href="{{ url_for('usuarios.admin_listar_usuarios') }}" class="btn btn-warning">
                            <i class="fas fa-users me-2"></i>Gestionar Usuarios
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.stretched-link::after {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: 1;
    content: "";
}
</style>
{% endblock %}